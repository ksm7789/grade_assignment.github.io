<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>ë°˜í¸ì„± í”„ë¡œê·¸ë¨ (í•™ë…„ìš©)</title>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      font-family: 'Noto Sans KR', -apple-system, sans-serif;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      overflow-x: hidden;
      background: #ffffff;
    }

    /* ë°˜ì‘í˜• ë¯¸ë””ì–´ ì¿¼ë¦¬ */
    @media (max-width: 768px) {
      .main-container {
        padding: 1rem !important;
      }
    }

    @media (max-width: 640px) {
      .result-grid {
        grid-template-columns: 1fr !important;
        gap: 1rem !important;
      }
    }
  </style>
</head>
<body>
  <div id="root"></div>
  
  <script type="text/babel">
    const { useState, useEffect } = React;

    // ì•„ì´ì½˜ ì»´í¬ë„ŒíŠ¸ë“¤
    const Upload = () => (
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M17 8l-5-5-5 5M12 3v12"/>
      </svg>
    );

    const Trash = () => (
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <path d="M3 6h18M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
      </svg>
    );

    function App() {
      const [classFiles, setClassFiles] = useState([]);
      const [numClasses, setNumClasses] = useState(3);
      const [showClassModal, setShowClassModal] = useState(false);
      const [isUploadComplete, setIsUploadComplete] = useState(false);

      // í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ ê²½ê³ 
      useEffect(() => {
        const handleBeforeUnload = (e) => {
          if (classFiles.length > 0) {
            const message = 'âš ï¸ í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•˜ë©´ ëª¨ë“  ë°ì´í„°ê°€ ì‚­ì œë©ë‹ˆë‹¤. ê³„ì†í•˜ì‹œê² ìŠµë‹ˆê¹Œ?';
            e.preventDefault();
            e.returnValue = message;
            return message;
          }
        };

        window.addEventListener('beforeunload', handleBeforeUnload);
        return () => window.removeEventListener('beforeunload', handleBeforeUnload);
      }, [classFiles]);

      // ì´ˆê¸°í™” í•¨ìˆ˜
      const resetAll = () => {
        if (confirm('ëª¨ë“  ë°ì´í„°ë¥¼ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.')) {
          window.location.reload();
        }
      };

      // ì—…ë¡œë“œ ì™„ë£Œ ì²˜ë¦¬
      const handleUploadComplete = () => {
        if (classFiles.length === 0) {
          alert('ì—…ë¡œë“œëœ íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤.');
          return;
        }
        setIsUploadComplete(true);
      };

      // íŒŒì¼ ìˆ˜ì •í•˜ê¸° (ì—…ë¡œë“œ ì™„ë£Œ ìƒíƒœë§Œ í•´ì œ)
      const handleEditUpload = () => {
        setIsUploadComplete(false);
      };

      // ë°˜í¸ì„± ì‹¤í–‰
      const executeAssignment = () => {
        if (!isUploadComplete) {
          alert('ë¨¼ì € "ì—…ë¡œë“œ ì™„ë£Œ" ë²„íŠ¼ì„ í´ë¦­í•´ì£¼ì„¸ìš”.');
          return;
        }
        if (classFiles.length === 0) {
          alert('ì—…ë¡œë“œëœ íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤.');
          return;
        }

        try {
          // ë°˜ë³„ë¡œ í•™ìƒ ë°ì´í„° ì·¨í•© (Aë°˜, Bë°˜, Cë°˜ ë“±)
          const classSummary = {};
          
          classFiles.forEach(file => {
            file.students.forEach(student => {
              const assignedClass = student.assignedClass;
              
              // 'ì›ë³¸' ì‹œíŠ¸ëŠ” ì œì™¸
              if (assignedClass === 'ì›ë³¸') return;
              
              if (!classSummary[assignedClass]) {
                classSummary[assignedClass] = [];
              }
              
              classSummary[assignedClass].push(student);
            });
          });

          setResults(classSummary);
          setOriginalResults(JSON.parse(JSON.stringify(classSummary))); // ì›ë³¸ ì €ì¥
          alert('ë°˜í¸ì„±ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!');
        } catch (error) {
          alert('ë°˜í¸ì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
        }
      };

      const [results, setResults] = useState(null);
      const [originalResults, setOriginalResults] = useState(null);
      const [isResultEditMode, setIsResultEditMode] = useState(false);
      const [selectedStudentsForSwap, setSelectedStudentsForSwap] = useState([]);
      const [nameSortOrder, setNameSortOrder] = useState({});
      const [genderSortOrder, setGenderSortOrder] = useState({});
      const [showProhibitModal, setShowProhibitModal] = useState(false);
      const [prohibitPairs, setProhibitPairs] = useState([]); // [{student1: {id, name, class}, student2: {id, name, class}}]
      const [forceUpdateKey, setForceUpdateKey] = useState(0);
      const [isCompleted, setIsCompleted] = useState(false); // ë°˜í¸ì„± ì™„ë£Œ ì—¬ë¶€

      // ê°€ë‚˜ë‹¤ìˆœ ì •ë ¬
      const sortByName = (className) => {
        if (!results) return;
        
        const currentOrder = nameSortOrder[className] || 'none';
        const newOrder = currentOrder === 'asc' ? 'desc' : 'asc';
        
        const sortedStudents = [...results[className]].sort((a, b) => {
          if (newOrder === 'asc') {
            return a.name.localeCompare(b.name, 'ko');
          } else {
            return b.name.localeCompare(a.name, 'ko');
          }
        });
        
        setNameSortOrder({ ...nameSortOrder, [className]: newOrder });
        setGenderSortOrder({ ...genderSortOrder, [className]: 'none' });
        setResults({
          ...results,
          [className]: sortedStudents
        });
      };

      // ëª¨ë“  ë°˜ ê°€ë‚˜ë‹¤ìˆœ ì •ë ¬
      const sortAllByName = () => {
        if (!results) return;
        
        const newResults = {};
        const newNameOrder = {};
        const newGenderOrder = {};
        
        Object.keys(results).forEach(className => {
          const currentOrder = nameSortOrder[className] || 'none';
          const newOrder = currentOrder === 'asc' ? 'desc' : 'asc';
          
          const sortedStudents = [...results[className]].sort((a, b) => {
            if (newOrder === 'asc') {
              return a.name.localeCompare(b.name, 'ko');
            } else {
              return b.name.localeCompare(a.name, 'ko');
            }
          });
          
          newResults[className] = sortedStudents;
          newNameOrder[className] = newOrder;
          newGenderOrder[className] = 'none';
        });
        
        setResults(newResults);
        setNameSortOrder(newNameOrder);
        setGenderSortOrder(newGenderOrder);
      };

      // ì„±ë³„ìˆœ ì •ë ¬
      const sortByGender = (className) => {
        if (!results) return;
        
        const currentOrder = genderSortOrder[className] || 'none';
        const newOrder = currentOrder === 'male-first' ? 'female-first' : 'male-first';
        
        const sortedStudents = [...results[className]].sort((a, b) => {
          // ì„±ë³„ ìš°ì„  ì •ë ¬
          if (newOrder === 'male-first') {
            if (a.gender === 'ë‚¨ì„±' && b.gender === 'ì—¬ì„±') return -1;
            if (a.gender === 'ì—¬ì„±' && b.gender === 'ë‚¨ì„±') return 1;
          } else {
            if (a.gender === 'ì—¬ì„±' && b.gender === 'ë‚¨ì„±') return -1;
            if (a.gender === 'ë‚¨ì„±' && b.gender === 'ì—¬ì„±') return 1;
          }
          
          // ì„±ë³„ì´ ê°™ìœ¼ë©´ ì›ë˜ë°˜ ìˆœì„œ ìœ ì§€
          const classA = parseInt(a.originalClass) || 0;
          const classB = parseInt(b.originalClass) || 0;
          if (classA !== classB) return classA - classB;
          
          // ì›ë˜ë°˜ë„ ê°™ìœ¼ë©´ ë²ˆí˜¸ ìˆœì„œ
          return (parseInt(a.number) || 0) - (parseInt(b.number) || 0);
        });
        
        setGenderSortOrder({ ...genderSortOrder, [className]: newOrder });
        setNameSortOrder({ ...nameSortOrder, [className]: 'none' });
        setResults({
          ...results,
          [className]: sortedStudents
        });
      };

      // ëª¨ë“  ë°˜ ì„±ë³„ìˆœ ì •ë ¬
      const sortAllByGender = () => {
        if (!results) return;
        
        const newResults = {};
        const newGenderOrder = {};
        const newNameOrder = {};
        
        Object.keys(results).forEach(className => {
          const currentOrder = genderSortOrder[className] || 'none';
          const newOrder = currentOrder === 'male-first' ? 'female-first' : 'male-first';
          
          const sortedStudents = [...results[className]].sort((a, b) => {
            // ì„±ë³„ ìš°ì„  ì •ë ¬
            if (newOrder === 'male-first') {
              if (a.gender === 'ë‚¨ì„±' && b.gender === 'ì—¬ì„±') return -1;
              if (a.gender === 'ì—¬ì„±' && b.gender === 'ë‚¨ì„±') return 1;
            } else {
              if (a.gender === 'ì—¬ì„±' && b.gender === 'ë‚¨ì„±') return -1;
              if (a.gender === 'ë‚¨ì„±' && b.gender === 'ì—¬ì„±') return 1;
            }
            
            // ì„±ë³„ì´ ê°™ìœ¼ë©´ ì›ë˜ë°˜ ìˆœì„œ ìœ ì§€
            const classA = parseInt(a.originalClass) || 0;
            const classB = parseInt(b.originalClass) || 0;
            if (classA !== classB) return classA - classB;
            
            // ì›ë˜ë°˜ë„ ê°™ìœ¼ë©´ ë²ˆí˜¸ ìˆœì„œ
            return (parseInt(a.number) || 0) - (parseInt(b.number) || 0);
          });
          
          newResults[className] = sortedStudents;
          newGenderOrder[className] = newOrder;
          newNameOrder[className] = 'none';
        });
        
        setResults(newResults);
        setGenderSortOrder(newGenderOrder);
        setNameSortOrder(newNameOrder);
      };

      // ì›ë˜ëŒ€ë¡œ (ì •ë ¬ ì´ˆê¸°í™”)
      const resetToOriginal = (className) => {
        if (!originalResults) return;
        
        setResults({
          ...results,
          [className]: [...originalResults[className]]
        });
        setNameSortOrder({ ...nameSortOrder, [className]: 'none' });
        setGenderSortOrder({ ...genderSortOrder, [className]: 'none' });
      };

      // ëª¨ë“  ë°˜ ì›ë˜ëŒ€ë¡œ
      const resetAllToOriginal = () => {
        if (!originalResults) return;
        
        const newResults = {};
        const newNameOrder = {};
        const newGenderOrder = {};
        
        Object.keys(originalResults).forEach(className => {
          newResults[className] = [...originalResults[className]];
          newNameOrder[className] = 'none';
          newGenderOrder[className] = 'none';
        });
        
        setResults(newResults);
        setNameSortOrder(newNameOrder);
        setGenderSortOrder(newGenderOrder);
      };

      // í•™ìƒ ì„ íƒ (ë§êµí™˜ìš©)
      const toggleStudentSelection = (className, studentId) => {
        const selected = selectedStudentsForSwap.find(s => s.className === className && s.studentId === studentId);
        
        if (selected) {
          setSelectedStudentsForSwap(selectedStudentsForSwap.filter(s => !(s.className === className && s.studentId === studentId)));
        } else {
          if (selectedStudentsForSwap.length === 0) {
            setSelectedStudentsForSwap([{ className, studentId }]);
          } else if (selectedStudentsForSwap.length === 1) {
            // ê°™ì€ ë°˜ì¸ì§€ í™•ì¸
            if (selectedStudentsForSwap[0].className === className) {
              alert('ê°™ì€ ë°˜ ë‚´ì—ì„œëŠ” ë§êµí™˜í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
              return;
            }
            // ë‘ ë²ˆì§¸ í•™ìƒ ì„ íƒ ì‹œ ìë™ìœ¼ë¡œ êµí™˜
            const newSelection = [...selectedStudentsForSwap, { className, studentId }];
            swapStudentsAuto(newSelection);
          }
        }
      };

      // í•™ìƒ ë§êµí™˜ (ìë™)
      const swapStudentsAuto = (selection) => {
        if (selection.length !== 2) return;

        const [student1, student2] = selection;
        
        // ê°™ì€ ë°˜ì¸ì§€ ì²´í¬ (ì´ë¯¸ toggleStudentSelectionì—ì„œ ì²´í¬í•˜ì§€ë§Œ ì•ˆì „ì¥ì¹˜)
        if (student1.className === student2.className) {
          alert('ê°™ì€ ë°˜ ë‚´ì—ì„œëŠ” ë§êµí™˜í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
          setSelectedStudentsForSwap([]);
          return;
        }
        
        // í•™ìƒ ì •ë³´ ì°¾ê¸°
        const class1Students = results[student1.className];
        const class2Students = results[student2.className];
        
        const s1 = class1Students.find(s => s.id === student1.studentId);
        const s2 = class2Students.find(s => s.id === student2.studentId);
        
        if (!s1 || !s2) return;
        
        // í™•ì¸ ë©”ì‹œì§€
        const message = `${student1.className} ${s1.name} â†” ${student2.className} ${s2.name}\ní•™ìƒì„ ë§êµí™˜í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`;
        
        if (!confirm(message)) {
          setSelectedStudentsForSwap([]);
          return;
        }

        const newResults = { ...results };

        const class1StudentsCopy = [...newResults[student1.className]];
        const class2StudentsCopy = [...newResults[student2.className]];

        const idx1 = class1StudentsCopy.findIndex(s => s.id === student1.studentId);
        const idx2 = class2StudentsCopy.findIndex(s => s.id === student2.studentId);

        // ë‹¤ë¥¸ ë°˜ ê°„ êµí™˜
        const temp = class1StudentsCopy[idx1];
        class1StudentsCopy[idx1] = class2StudentsCopy[idx2];
        class2StudentsCopy[idx2] = temp;
        
        newResults[student1.className] = class1StudentsCopy;
        newResults[student2.className] = class2StudentsCopy;

        setResults(newResults);
        setSelectedStudentsForSwap([]);
      };

      // í•™ìƒ ì´ë™
      const moveStudent = (fromClass, studentId, toClass) => {
        if (fromClass === toClass) return;

        const newResults = { ...results };
        const fromStudents = [...newResults[fromClass]];
        const toStudents = [...newResults[toClass]];

        const studentIndex = fromStudents.findIndex(s => s.id === studentId);
        const student = fromStudents[studentIndex];

        fromStudents.splice(studentIndex, 1);
        toStudents.push(student);

        newResults[fromClass] = fromStudents;
        newResults[toClass] = toStudents;

        setResults(newResults);
      };

      // ì—‘ì…€ ë‹¤ìš´ë¡œë“œ
      const downloadExcel = () => {
        if (!results) return;

        const wb = XLSX.utils.book_new();

        // 1. ì·¨í•© ì‹œíŠ¸ (ëª¨ë“  í•™ìƒ ì •ë³´)
        const allStudentsData = [];
        Object.keys(results).sort().forEach(className => {
          results[className].forEach(student => {
            allStudentsData.push({
              'í•™ìƒê°œì¸ë²ˆí˜¸': student.studentId || '',
              'í•™ë…„': student.grade || '',
              'ë°˜': student.originalClass,
              'ë²ˆí˜¸': student.number,
              'ì´ë¦„': student.name,
              'ì„±ë³„': student.gender,
              'ìƒë…„ì›”ì¼': student.birthDate || '',
              'íŠ¹ì´ì‚¬í•­': student.specialNote || '',
              'ì›ë˜ë°˜': student.originalClass,
              'ë°°ì •ë°˜': className
            });
          });
        });
        const allStudentsWs = XLSX.utils.json_to_sheet(allStudentsData);
        XLSX.utils.book_append_sheet(wb, allStudentsWs, 'ì·¨í•©');

        // 2. ê° ë°˜ë³„ ì‹œíŠ¸ (Aë°˜, Bë°˜, Cë°˜...)
        Object.keys(results).sort().forEach(className => {
          const students = results[className];
          const data = students.map(s => ({
            'í•™ìƒê°œì¸ë²ˆí˜¸': s.studentId || '',
            'í•™ë…„': s.grade || '',
            'ë°˜': s.originalClass,
            'ë²ˆí˜¸': s.number,
            'ì´ë¦„': s.name,
            'ì„±ë³„': s.gender,
            'ìƒë…„ì›”ì¼': s.birthDate || '',
            'íŠ¹ì´ì‚¬í•­': s.specialNote || '',
            'ì›ë˜ë°˜': s.originalClass,
            'ë°°ì •ë°˜': className
          }));

          const ws = XLSX.utils.json_to_sheet(data);
          XLSX.utils.book_append_sheet(wb, ws, className);
        });

        XLSX.writeFile(wb, 'í•™ë…„_ë°˜í¸ì„±_ê²°ê³¼.xlsx');
      };

      // ê°™ì€ ë°˜ ê¸ˆì§€ í•™ìƒ ì²´í¬ (active ìƒíƒœë§Œ)
      const isProhibitedPair = (studentId1, studentId2) => {
        return prohibitPairs.some(pair => 
          pair.active && (
            (pair.student1.id === studentId1 && pair.student2.id === studentId2) ||
            (pair.student1.id === studentId2 && pair.student2.id === studentId1)
          )
        );
      };

      // ê°™ì€ ë°˜ì— ê¸ˆì§€ í•™ìƒì´ ìˆëŠ”ì§€ ì²´í¬ (active ìƒíƒœë§Œ)
      const hasProhibitedStudent = (className, studentId) => {
        if (!results) return false;
        const classStudents = results[className];
        return classStudents.some(s => s.id !== studentId && isProhibitedPair(studentId, s.id));
      };

      // íŒŒì¼ ì—…ë¡œë“œ í•¸ë“¤ëŸ¬
      const handleFileUpload = (e) => {
        const files = Array.from(e.target.files);
        
        files.forEach(file => {
          const reader = new FileReader();
          reader.onload = (event) => {
            try {
              const workbook = XLSX.read(event.target.result, { type: 'binary' });
              
              // ëª¨ë“  ì‹œíŠ¸ì˜ ë°ì´í„°ë¥¼ ì½ê¸°
              const allStudents = [];
              const fileId = Date.now() + Math.random();
              let studentCounter = 0;
              
              workbook.SheetNames.forEach(sheetName => {
                const sheet = workbook.Sheets[sheetName];
                const data = XLSX.utils.sheet_to_json(sheet);

                data.forEach((row) => {
                  let gender = row['ì„±ë³„'] || '';
                  if (gender === 'ë‚¨' || gender === 'M') gender = 'ë‚¨ì„±';
                  else if (gender === 'ì—¬' || gender === 'F') gender = 'ì—¬ì„±';
                  
                  allStudents.push({
                    id: `${fileId}-${sheetName}-${studentCounter++}`, // ê³ ìœ  ID
                    studentId: row['í•™ìƒê°œì¸ë²ˆí˜¸'] || '',
                    grade: row['í•™ë…„'] || '',
                    originalClass: String(row['ì›ë˜ë°˜'] || row['ë°˜'] || ''),
                    number: row['ë²ˆí˜¸'] || '',
                    name: row['ì´ë¦„'] || '',
                    gender: gender,
                    birthDate: row['ìƒë…„ì›”ì¼'] || '',
                    specialNote: row['íŠ¹ì´ì‚¬í•­'] || '',
                    assignedClass: sheetName // ë°°ì •ëœ ë°˜ (Aë°˜, Bë°˜ ë“±)
                  });
                });
              });

              setClassFiles(prev => [...prev, {
                id: fileId,
                fileName: file.name,
                students: allStudents
              }]);
            } catch (error) {
              alert(`${file.name} íŒŒì¼ì„ ì½ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.`);
            }
          };
          reader.readAsBinaryString(file);
        });

        // íŒŒì¼ input ì´ˆê¸°í™”
        e.target.value = '';
      };

      // íŒŒì¼ ì‚­ì œ
      const removeFile = (fileId) => {
        if (confirm('ì´ ë°˜ ë°ì´í„°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
          setClassFiles(prev => prev.filter(f => f.id !== fileId));
        }
      };

      return (
        <div style={{
          minHeight: '100vh',
          background: '#ffffff',
          padding: '2rem'
        }}>
          {/* í•™ê¸‰ ìˆ˜ ì„¤ì • ëª¨ë‹¬ */}
          {showClassModal && (
            <div style={{
              position: 'fixed',
              top: 0,
              left: 0,
              right: 0,
              bottom: 0,
              background: 'rgba(0, 0, 0, 0.5)',
              display: 'flex',
              alignItems: 'center',
              justifyContent: 'center',
              zIndex: 1000
            }}
            onClick={() => setShowClassModal(false)}
            >
              <div style={{
                background: 'white',
                borderRadius: '16px',
                padding: '2rem',
                maxWidth: '400px',
                width: '90%',
                boxShadow: '0 20px 60px rgba(0, 0, 0, 0.3)'
              }}
              onClick={(e) => e.stopPropagation()}
              >
                <h3 style={{
                  margin: '0 0 1.5rem 0',
                  fontSize: '1.5rem',
                  fontWeight: '700',
                  color: '#333'
                }}>
                  í•™ê¸‰ ìˆ˜ ì„¤ì •
                </h3>
                
                <div style={{
                  display: 'grid',
                  gridTemplateColumns: 'repeat(3, 1fr)',
                  gap: '0.75rem',
                  marginBottom: '1.5rem'
                }}>
                  {[1, 2, 3, 4, 5, 6, 7, 8, 9, 10].map(num => (
                    <button
                      key={num}
                      onClick={() => {
                        setNumClasses(num);
                        setShowClassModal(false);
                      }}
                      style={{
                        padding: '1rem',
                        background: numClasses === num ? '#4facfe' : 'white',
                        color: numClasses === num ? 'white' : '#333',
                        border: numClasses === num ? 'none' : '2px solid #e0e0e0',
                        borderRadius: '8px',
                        fontSize: '1.1rem',
                        fontWeight: '600',
                        cursor: 'pointer',
                        transition: 'all 0.2s'
                      }}
                      onMouseEnter={(e) => {
                        if (numClasses !== num) {
                          e.target.style.borderColor = '#4facfe';
                          e.target.style.background = '#f0f9ff';
                        }
                      }}
                      onMouseLeave={(e) => {
                        if (numClasses !== num) {
                          e.target.style.borderColor = '#e0e0e0';
                          e.target.style.background = 'white';
                        }
                      }}
                    >
                      {num}ê°œ
                    </button>
                  ))}
                </div>

                <button
                  onClick={() => setShowClassModal(false)}
                  style={{
                    width: '100%',
                    padding: '0.75rem',
                    background: '#f8f9fa',
                    color: '#666',
                    border: 'none',
                    borderRadius: '8px',
                    fontSize: '1rem',
                    fontWeight: '600',
                    cursor: 'pointer'
                  }}
                >
                  ë‹«ê¸°
                </button>
              </div>
            </div>
          )}

          {/* í—¤ë” */}
          <div style={{
            background: '#4facfe',
            borderRadius: '24px',
            padding: '2rem',
            marginBottom: '2rem',
            boxShadow: '0 10px 40px rgba(79, 172, 254, 0.3)',
            position: 'relative'
          }}>
            <h1 style={{
              fontSize: '2.5rem',
              fontWeight: '800',
              color: 'white',
              textAlign: 'center',
              marginBottom: '0.5rem',
              textShadow: '0 2px 8px rgba(0,0,0,0.15)'
            }}>
              ë°˜í¸ì„± í”„ë¡œê·¸ë¨ (í•™ë…„ìš©)
            </h1>
            <p style={{
              fontSize: '1rem',
              color: 'white',
              textAlign: 'center',
              fontWeight: '600',
              textShadow: '0 1px 4px rgba(0,0,0,0.12)'
            }}>
              í•™ê¸‰ë³„ ë°˜í¸ì„± ê²°ê³¼ë¥¼ í†µí•©ê´€ë¦¬í•˜ì—¬ ìƒˆë¡œìš´ í•™ë…„ ë°˜í¸ì„±
            </p>

            {/* ì´ˆê¸°í™” ë²„íŠ¼ */}
            <div style={{
              display: 'flex',
              justifyContent: 'flex-end',
              paddingTop: '1.5rem',
              position: 'relative'
            }}>
              <button
                onClick={resetAll}
                style={{
                  padding: '0.6rem 1.2rem',
                  background: 'white',
                  color: '#4facfe',
                  border: '2px solid #e0e0e0',
                  borderRadius: '8px',
                  cursor: 'pointer',
                  fontWeight: '600',
                  fontSize: '0.85rem',
                  display: 'flex',
                  alignItems: 'center',
                  gap: '0.4rem',
                  transition: 'all 0.2s',
                  boxShadow: '0 2px 6px rgba(0, 0, 0, 0.1)'
                }}
                onMouseEnter={(e) => {
                  e.target.style.background = '#f8f9fa';
                  e.target.style.transform = 'scale(1.05)';
                  e.target.style.boxShadow = '0 4px 12px rgba(0, 0, 0, 0.15)';
                }}
                onMouseLeave={(e) => {
                  e.target.style.background = 'white';
                  e.target.style.transform = 'scale(1)';
                  e.target.style.boxShadow = '0 2px 6px rgba(0, 0, 0, 0.1)';
                }}
              >
                ğŸ”„ ì´ˆê¸°í™”
              </button>
            </div>
          </div>

          {/* ë©”ì¸ ì»¨í…ì¸  */}
          <div style={{
            maxWidth: '1200px',
            margin: '0 auto'
          }}>
            {/* íŒŒì¼ ì—…ë¡œë“œ + í•™ê¸‰ ìˆ˜ ì„¤ì • (ê°™ì€ ì¤„) */}
            <div style={{
              display: 'flex',
              gap: '1.5rem',
              marginBottom: '2rem',
              flexWrap: 'wrap'
            }}>
              {/* íŒŒì¼ ì—…ë¡œë“œ ì„¹ì…˜ */}
              <div style={{
                flex: 1,
                minWidth: '300px',
                background: 'white',
                border: '2px solid #e0e0e0',
                borderRadius: '16px',
                padding: '2rem',
                boxShadow: '0 4px 20px rgba(0, 0, 0, 0.08)',
                opacity: isUploadComplete ? 0.6 : 1,
                pointerEvents: isUploadComplete ? 'none' : 'auto'
              }}>
                <div style={{ display: 'flex', alignItems: 'center', marginBottom: '1rem' }}>
                  <Upload />
                  <h3 style={{ 
                    margin: '0 0 0 0.5rem', 
                    fontSize: '1.3rem', 
                    fontWeight: '700',
                    color: '#333'
                  }}>
                    ë°˜í¸ì„± ê²°ê³¼ íŒŒì¼ ì—…ë¡œë“œ
                  </h3>
                </div>
                
                <p style={{
                  color: '#666',
                  fontSize: '0.9rem',
                  marginBottom: '1rem',
                  lineHeight: '1.6'
                }}>
                  ê° í•™ê¸‰ì—ì„œ ë°˜í¸ì„±í•œ ì—‘ì…€ íŒŒì¼ì„ ì—¬ëŸ¬ ê°œ ì—…ë¡œë“œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br/>
                  íŒŒì¼ëª…ìœ¼ë¡œ ë°˜ì„ êµ¬ë¶„í•©ë‹ˆë‹¤. (ì˜ˆ: 1ë°˜.xlsx, 2ë°˜.xlsx)
                </p>

                <input
                  type="file"
                  accept=".xlsx,.xls"
                  multiple
                  onChange={handleFileUpload}
                  disabled={isUploadComplete}
                  style={{
                    width: '100%',
                    padding: '0.75rem',
                    background: '#f8f9fa',
                    border: '2px dashed #667eea',
                    borderRadius: '8px',
                    cursor: isUploadComplete ? 'not-allowed' : 'pointer',
                    color: classFiles.length > 0 ? 'transparent' : '#333',
                    fontWeight: '500',
                    fontSize: '1rem'
                  }}
                />
              </div>

              {/* í•™ê¸‰ ìˆ˜ ì„¤ì • */}
              <div style={{
                flex: 1,
                minWidth: '300px',
                background: 'white',
                border: '2px solid #e0e0e0',
                borderRadius: '16px',
                padding: '2rem',
                boxShadow: '0 4px 20px rgba(0, 0, 0, 0.08)'
              }}>
                <h3 style={{
                  fontSize: '1.3rem',
                  fontWeight: '700',
                  marginBottom: '1rem',
                  color: '#333'
                }}>
                  âš™ï¸ í•™ê¸‰ ìˆ˜ ì„¤ì •
                </h3>
                
                <button
                  onClick={() => setShowClassModal(true)}
                  style={{
                    width: '100%',
                    padding: '0.75rem',
                    background: 'white',
                    border: '2px solid #e0e0e0',
                    borderRadius: '8px',
                    fontSize: '1rem',
                    fontWeight: '600',
                    color: '#333',
                    cursor: 'pointer',
                    textAlign: 'left',
                    display: 'flex',
                    justifyContent: 'space-between',
                    alignItems: 'center',
                    transition: 'all 0.2s'
                  }}
                  onMouseEnter={(e) => {
                    e.target.style.borderColor = '#667eea';
                    e.target.style.boxShadow = '0 4px 12px rgba(102, 126, 234, 0.2)';
                  }}
                  onMouseLeave={(e) => {
                    e.target.style.borderColor = '#e0e0e0';
                    e.target.style.boxShadow = 'none';
                  }}
                >
                  <span>{numClasses}ê°œ í•™ê¸‰</span>
                  <span style={{ fontSize: '1.2rem' }}>â–¼</span>
                </button>
              </div>
            </div>

            {/* ì—…ë¡œë“œëœ íŒŒì¼ ëª©ë¡ */}
            {classFiles.length > 0 && (
              <div style={{
                background: 'white',
                border: '2px solid #e0e0e0',
                borderRadius: '16px',
                padding: '2rem',
                marginBottom: '2rem',
                boxShadow: '0 4px 20px rgba(0, 0, 0, 0.08)'
              }}>
                <h3 style={{
                  fontSize: '1.3rem',
                  fontWeight: '700',
                  marginBottom: '1.5rem',
                  color: '#333'
                }}>
                  ì—…ë¡œë“œëœ ë°˜ ëª©ë¡ ({classFiles.length}ê°œ)
                </h3>

                <div style={{
                  display: 'grid',
                  gap: '1rem'
                }}>
                  {classFiles.map(file => (
                    <div
                      key={file.id}
                      style={{
                        background: '#f8f9fa',
                        border: '2px solid #e0e0e0',
                        borderRadius: '12px',
                        padding: '1.5rem',
                        display: 'flex',
                        justifyContent: 'space-between',
                        alignItems: 'center',
                        transition: 'all 0.2s'
                      }}
                      onMouseEnter={(e) => {
                        e.currentTarget.style.borderColor = '#667eea';
                        e.currentTarget.style.boxShadow = '0 4px 12px rgba(102, 126, 234, 0.2)';
                      }}
                      onMouseLeave={(e) => {
                        e.currentTarget.style.borderColor = '#e0e0e0';
                        e.currentTarget.style.boxShadow = 'none';
                      }}
                    >
                      <div>
                        <div style={{
                          fontSize: '1.1rem',
                          fontWeight: '700',
                          color: '#333',
                          marginBottom: '0.5rem'
                        }}>
                          ğŸ“„ {file.fileName}
                        </div>
                        <div style={{
                          fontSize: '0.9rem',
                          color: '#666'
                        }}>
                          {(() => {
                            const originalStudents = file.students.filter(s => s.assignedClass === 'ì›ë³¸');
                            const maleCount = originalStudents.filter(s => s.gender === 'ë‚¨ì„±').length;
                            const femaleCount = originalStudents.filter(s => s.gender === 'ì—¬ì„±').length;
                            return `í•™ìƒ ìˆ˜: ${originalStudents.length}ëª… | ë‚¨ì„±: ${maleCount}ëª… | ì—¬ì„±: ${femaleCount}ëª…`;
                          })()}
                        </div>
                      </div>
                      
                      <button
                        onClick={() => removeFile(file.id)}
                        disabled={isUploadComplete}
                        style={{
                          padding: '0.6rem 1rem',
                          background: isUploadComplete ? '#cccccc' : '#ff6b6b',
                          color: 'white',
                          border: 'none',
                          borderRadius: '8px',
                          cursor: isUploadComplete ? 'not-allowed' : 'pointer',
                          fontWeight: '600',
                          fontSize: '0.85rem',
                          display: 'flex',
                          alignItems: 'center',
                          gap: '0.4rem',
                          transition: 'all 0.2s',
                          opacity: isUploadComplete ? 0.6 : 1
                        }}
                        onMouseEnter={(e) => {
                          if (!isUploadComplete) {
                            e.target.style.background = '#ff5252';
                            e.target.style.transform = 'scale(1.05)';
                          }
                        }}
                        onMouseLeave={(e) => {
                          if (!isUploadComplete) {
                            e.target.style.background = '#ff6b6b';
                            e.target.style.transform = 'scale(1)';
                          }
                        }}
                      >
                        <Trash />
                        ì‚­ì œ
                      </button>
                    </div>
                  ))}
                </div>
              </div>
            )}

            {/* ì—…ë¡œë“œ ì™„ë£Œ / ë°˜í¸ì„± ì‹¤í–‰ ë²„íŠ¼ */}
            <div style={{
              background: 'white',
              border: '2px solid #e0e0e0',
              borderRadius: '16px',
              padding: '2rem',
              marginBottom: '2rem',
              boxShadow: '0 4px 20px rgba(0, 0, 0, 0.08)',
              display: 'flex',
              gap: '1rem',
              flexWrap: 'wrap'
            }}>
              <button
                onClick={isUploadComplete ? handleEditUpload : handleUploadComplete}
                style={{
                  flex: 1,
                  minWidth: '200px',
                  padding: '1rem 1.5rem',
                  background: isUploadComplete ? '#f5576c' : '#4facfe',
                  color: 'white',
                  border: 'none',
                  borderRadius: '12px',
                  fontSize: '1.1rem',
                  fontWeight: '700',
                  cursor: 'pointer',
                  transition: 'all 0.3s',
                  boxShadow: '0 4px 15px rgba(0, 0, 0, 0.2)'
                }}
                onMouseEnter={(e) => {
                  e.target.style.transform = 'translateY(-2px)';
                  e.target.style.boxShadow = '0 6px 20px rgba(0, 0, 0, 0.25)';
                }}
                onMouseLeave={(e) => {
                  e.target.style.transform = 'translateY(0)';
                  e.target.style.boxShadow = '0 4px 15px rgba(0, 0, 0, 0.2)';
                }}
              >
                {isUploadComplete ? 'ğŸ“ ì—…ë¡œë“œ íŒŒì¼ ìˆ˜ì •í•˜ê¸°' : 'âœ… ì—…ë¡œë“œ ì™„ë£Œ'}
              </button>

              <button
                onClick={executeAssignment}
                disabled={!isUploadComplete}
                style={{
                  flex: 1,
                  minWidth: '200px',
                  padding: '1rem 1.5rem',
                  background: isUploadComplete ? '#667eea' : '#cccccc',
                  color: 'white',
                  border: 'none',
                  borderRadius: '12px',
                  fontSize: '1.1rem',
                  fontWeight: '700',
                  cursor: isUploadComplete ? 'pointer' : 'not-allowed',
                  transition: 'all 0.3s',
                  boxShadow: '0 4px 15px rgba(0, 0, 0, 0.2)',
                  opacity: isUploadComplete ? 1 : 0.6
                }}
                onMouseEnter={(e) => {
                  if (isUploadComplete) {
                    e.target.style.transform = 'translateY(-2px)';
                    e.target.style.boxShadow = '0 6px 20px rgba(0, 0, 0, 0.25)';
                  }
                }}
                onMouseLeave={(e) => {
                  if (isUploadComplete) {
                    e.target.style.transform = 'translateY(0)';
                    e.target.style.boxShadow = '0 4px 15px rgba(0, 0, 0, 0.2)';
                  }
                }}
              >
                ğŸš€ ë°˜í¸ì„± ì‹¤í–‰í•˜ê¸°
              </button>
            </div>

            {/* ë°˜í¸ì„± ê²°ê³¼ */}
            {results && (
              <div style={{
                background: 'white',
                border: '2px solid #e0e0e0',
                borderRadius: '16px',
                padding: '2rem',
                marginBottom: '2rem',
                boxShadow: '0 4px 20px rgba(0, 0, 0, 0.08)'
              }}>
                {/* ì œëª©ê³¼ ë²„íŠ¼ */}
                <div style={{
                  display: 'flex',
                  justifyContent: 'space-between',
                  alignItems: 'center',
                  marginBottom: '2rem',
                  flexWrap: 'wrap',
                  gap: '1rem'
                }}>
                  <h2 style={{
                    fontSize: '1.5rem',
                    fontWeight: '700',
                    color: '#333'
                  }}>
                    ğŸ“Š ë°˜í¸ì„± ê²°ê³¼
                  </h2>
                  
                  <div style={{ display: 'flex', gap: '0.75rem', flexWrap: 'wrap' }}>
                    {/* ì •ë ¬ ë²„íŠ¼ë“¤ */}
                    <button
                      onClick={sortAllByName}
                      style={{
                        padding: '0.75rem 1.5rem',
                        background: 'white',
                        color: '#667eea',
                        border: '2px solid #667eea',
                        borderRadius: '8px',
                        fontWeight: '600',
                        cursor: 'pointer',
                        fontSize: '1rem',
                        transition: 'all 0.2s'
                      }}
                      onMouseEnter={(e) => {
                        e.target.style.background = '#667eea';
                        e.target.style.color = 'white';
                      }}
                      onMouseLeave={(e) => {
                        e.target.style.background = 'white';
                        e.target.style.color = '#667eea';
                      }}
                    >
                      abc ê°€ë‚˜ë‹¤ë¶„ë¥˜
                    </button>
                    
                    <button
                      onClick={sortAllByGender}
                      style={{
                        padding: '0.75rem 1.5rem',
                        background: 'white',
                        color: '#f5576c',
                        border: '2px solid #f5576c',
                        borderRadius: '8px',
                        fontWeight: '600',
                        cursor: 'pointer',
                        fontSize: '1rem',
                        transition: 'all 0.2s'
                      }}
                      onMouseEnter={(e) => {
                        e.target.style.background = '#f5576c';
                        e.target.style.color = 'white';
                      }}
                      onMouseLeave={(e) => {
                        e.target.style.background = 'white';
                        e.target.style.color = '#f5576c';
                      }}
                    >
                      â™‚â™€ ì„±ë³„ë¶„ë¥˜
                    </button>
                    
                    <button
                      onClick={resetAllToOriginal}
                      style={{
                        padding: '0.75rem 1.5rem',
                        background: 'white',
                        color: '#4facfe',
                        border: '2px solid #4facfe',
                        borderRadius: '8px',
                        fontWeight: '600',
                        cursor: 'pointer',
                        fontSize: '1rem',
                        transition: 'all 0.2s'
                      }}
                      onMouseEnter={(e) => {
                        e.target.style.background = '#4facfe';
                        e.target.style.color = 'white';
                      }}
                      onMouseLeave={(e) => {
                        e.target.style.background = 'white';
                        e.target.style.color = '#4facfe';
                      }}
                    >
                      ì›ë˜ëŒ€ë¡œ
                    </button>
                  </div>
                </div>

                {/* ì•ˆë‚´ ë¬¸êµ¬ */}
                <div style={{
                  marginBottom: '1.5rem',
                  padding: '1rem',
                  background: 'linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%)',
                  borderRadius: '12px',
                  fontSize: '0.95rem',
                  color: '#1565c0',
                  fontWeight: '600',
                  textAlign: 'center'
                }}>
                  ğŸ’¡ í•™ìƒ ì´ë¦„ì„ í´ë¦­í•˜ì—¬ ë°˜ì„ êµì²´í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤
                </div>

                {/* ë°˜ ì¹´ë“œë“¤ - ê°€ë¡œ ë°°ì¹˜ */}
                <div style={{
                  display: 'grid',
                  gridTemplateColumns: 'repeat(auto-fit, minmax(350px, 1fr))',
                  gap: '1.5rem'
                }}>
                  {Object.keys(results).sort().map(className => {
                    const students = results[className];
                    const totalCount = students.length;
                    const maleCount = students.filter(s => s.gender === 'ë‚¨ì„±').length;
                    const femaleCount = students.filter(s => s.gender === 'ì—¬ì„±').length;

                    // ì›ë˜ë°˜ë³„ í†µê³„
                    const originalClassStats = {};
                    students.forEach(student => {
                      const origClass = student.originalClass || 'ë¯¸ë¶„ë¥˜';
                      if (!originalClassStats[origClass]) {
                        originalClassStats[origClass] = { male: 0, female: 0, total: 0 };
                      }
                      if (student.gender === 'ë‚¨ì„±') originalClassStats[origClass].male++;
                      else if (student.gender === 'ì—¬ì„±') originalClassStats[origClass].female++;
                      originalClassStats[origClass].total++;
                    });

                    // íŠ¹ì´ì‚¬í•­ í†µê³„
                    const specialNoteStats = {};
                    const noteOrder = ['ìš´ë™ë¶€', 'ë„ì›€ë°˜', 'ìŒìƒì•„', 'ë‹¤ë¬¸í™”'];
                    students.forEach(student => {
                      if (student.specialNote) {
                        const notes = student.specialNote.split(',').map(n => n.trim());
                        notes.forEach(note => {
                          if (noteOrder.includes(note)) {
                            if (!specialNoteStats[note]) specialNoteStats[note] = 0;
                            specialNoteStats[note]++;
                          }
                        });
                      }
                    });

                    // ë°˜ ë°°ê²½ìƒ‰
                    const classColors = {
                      'Aë°˜': 'linear-gradient(135deg, #a8edea 0%, #fed6e3 100%)',
                      'Bë°˜': 'linear-gradient(135deg, #d299c2 0%, #fef9d7 100%)',
                      'Cë°˜': 'linear-gradient(135deg, #fbc2eb 0%, #a6c1ee 100%)',
                      'Dë°˜': 'linear-gradient(135deg, #fdcbf1 0%, #e6dee9 100%)',
                      'Eë°˜': 'linear-gradient(135deg, #a1c4fd 0%, #c2e9fb 100%)'
                    };

                    return (
                      <div
                        key={`${className}-${forceUpdateKey}`}
                        style={{
                          background: classColors[className] || 'linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%)',
                          borderRadius: '12px',
                          padding: '1.5rem',
                          boxShadow: '0 4px 12px rgba(0, 0, 0, 0.1)'
                        }}
                      >
                        {/* ë°˜ ì´ë¦„ */}
                        <div style={{
                          fontSize: '1.5rem',
                          fontWeight: '800',
                          color: '#333',
                          marginBottom: '1rem',
                          textAlign: 'center'
                        }}>
                          {className}
                        </div>

                        {/* ì´ ì¸ì› */}
                        <div style={{
                          background: 'white',
                          padding: '0.75rem',
                          borderRadius: '8px',
                          marginBottom: '0.75rem',
                          fontSize: '0.95rem',
                          fontWeight: '600',
                          textAlign: 'center'
                        }}>
                          ì´ {totalCount}ëª… (ë‚¨ì„± {maleCount}ëª… / ì—¬ì„± {femaleCount}ëª…)
                        </div>

                        {/* ì›ë˜ë°˜ë³„ í†µê³„ */}
                        <div style={{
                          background: 'rgba(255, 255, 255, 0.8)',
                          padding: '0.75rem',
                          borderRadius: '8px',
                          marginBottom: '0.75rem',
                          fontSize: '0.85rem'
                        }}>
                          {Object.keys(originalClassStats).sort((a, b) => {
                            const numA = parseInt(a) || 0;
                            const numB = parseInt(b) || 0;
                            return numA - numB;
                          }).map(origClass => {
                            const stats = originalClassStats[origClass];
                            return (
                              <div key={origClass} style={{ padding: '0.25rem 0', color: '#555' }}>
                                {origClass}ë°˜: ë‚¨ {stats.male} / ì—¬ {stats.female} / í•©ê³„ {stats.total}
                              </div>
                            );
                          })}
                        </div>

                        {/* êµ¬ë¶„ì„  */}
                        <div style={{ height: '1px', background: 'rgba(0,0,0,0.1)', margin: '0.75rem 0' }}></div>

                        {/* íŠ¹ì´ì‚¬í•­ - ì£¼í™©ìƒ‰ ë°•ìŠ¤ */}
                        {Object.keys(specialNoteStats).length > 0 && (
                          <div style={{
                            background: '#fff3e0',
                            border: '2px solid #ff9800',
                            padding: '0.75rem',
                            borderRadius: '8px',
                            marginBottom: '0.75rem',
                            fontSize: '0.85rem'
                          }}>
                            <div style={{
                              fontWeight: '700',
                              color: '#e65100',
                              marginBottom: '0.5rem',
                              fontSize: '0.9rem'
                            }}>
                              âš ï¸ íŠ¹ì´ì‚¬í•­
                            </div>
                            {noteOrder.map(note => {
                              if (specialNoteStats[note]) {
                                return (
                                  <div key={note} style={{ 
                                    padding: '0.25rem 0', 
                                    color: '#e65100',
                                    fontWeight: '600'
                                  }}>
                                    {note}: {specialNoteStats[note]}ëª…
                                  </div>
                                );
                              }
                              return null;
                            })}
                          </div>
                        )}

                        {/* í•™ìƒ ëª©ë¡ */}
                        <div style={{
                          background: 'white',
                          borderRadius: '8px',
                          padding: '0.75rem'
                        }}>
                          {students.map((student, idx) => {
                            const isSelected = selectedStudentsForSwap.some(
                              s => s.className === className && s.studentId === student.id
                            );
                            
                            // íŠ¹ì´ì‚¬í•­ íŒŒì‹±
                            const specialNotes = student.specialNote ? student.specialNote.split(',').map(n => n.trim()).filter(n => n) : [];
                            
                            // ë™ëª…ì´ì¸ ë° ì´ë¦„ ì¤‘ë³µ ì²´í¬
                            const checkDuplicates = () => {
                              const duplicates = [];
                              
                              // í˜„ì¬ ë°˜ì—ì„œ ì²´í¬
                              students.forEach(s => {
                                if (s.id !== student.id) {
                                  // ë™ëª…ì´ì¸ ì²´í¬ (ì„± + ì´ë¦„ ëª¨ë‘ ê°™ìŒ)
                                  if (s.name === student.name) {
                                    if (!duplicates.includes('ë™ëª…ì´ì¸')) {
                                      duplicates.push('ë™ëª…ì´ì¸');
                                    }
                                  }
                                  // ì´ë¦„ë§Œ ê°™ìŒ ì²´í¬ (ì´ë¦„ë§Œ ê°™ê³  ì„±ì€ ë‹¤ë¦„)
                                  else {
                                    const currentFirstName = student.name.slice(1); // ì„± ì œì™¸í•œ ì´ë¦„
                                    const otherFirstName = s.name.slice(1);
                                    
                                    if (currentFirstName.length > 0 && 
                                        currentFirstName === otherFirstName && 
                                        student.name.length > 1 && 
                                        s.name.length > 1) {
                                      if (!duplicates.includes('ì´ë¦„ë§Œê°™ìŒ')) {
                                        duplicates.push('ì´ë¦„ë§Œê°™ìŒ');
                                      }
                                    }
                                  }
                                }
                              });
                              
                              return duplicates;
                            };
                            
                            const duplicateTypes = checkDuplicates();
                            
                            // ê°™ì€ ë°˜ ê¸ˆì§€ í•™ìƒ ì²´í¬ (ë‹¤ë¥¸ ë°˜ì´ì–´ë„ í‘œì‹œ)
                            const isProhibited = (() => {
                              // í˜„ì¬ prohibitPairs ìƒíƒœ í™•ì¸
                              const activePairs = prohibitPairs.filter(p => p.active);
                              
                              if (activePairs.length === 0) return false;
                              
                              const studentOrigClass = String(student.originalClass || '');
                              
                              for (const pair of activePairs) {
                                // í˜„ì¬ í•™ìƒì´ pairì˜ student1ì¸ì§€ í™•ì¸
                                const isStudent1Match = pair.student1.name === student.name && 
                                                       pair.student1.originalClass === studentOrigClass;
                                
                                if (isStudent1Match) return true;
                                
                                // í˜„ì¬ í•™ìƒì´ pairì˜ student2ì¸ì§€ í™•ì¸
                                const isStudent2Match = pair.student2.name === student.name && 
                                                       pair.student2.originalClass === studentOrigClass;
                                
                                if (isStudent2Match) return true;
                              }
                              return false;
                            })();
                            
                            return (
                              <div key={idx}>
                                <div
                                  onClick={() => toggleStudentSelection(className, student.id)}
                                  style={{
                                    padding: '0.6rem',
                                    marginBottom: isSelected ? '0.5rem' : '0.4rem',
                                    background: isSelected ? '#fff3cd' : '#f8f9fa',
                                    borderRadius: '6px',
                                    border: isProhibited ? '2px solid #f44336' : (isSelected ? '2px solid #ff9a56' : '1px solid #e0e0e0'),
                                    cursor: 'pointer',
                                    display: 'flex',
                                    justifyContent: 'space-between',
                                    alignItems: 'center',
                                    fontSize: '0.9rem'
                                  }}
                                >
                                  <div style={{ display: 'flex', gap: '0.5rem', alignItems: 'center', flex: 1, flexWrap: 'wrap' }}>
                                    {/* ì›ë˜ë°˜ í‘œì‹œ */}
                                    <span style={{
                                      padding: '0.2rem 0.4rem',
                                      background: '#e3f2fd',
                                      color: '#1565c0',
                                      borderRadius: '4px',
                                      fontSize: '0.7rem',
                                      fontWeight: '600',
                                      minWidth: '28px',
                                      textAlign: 'center'
                                    }}>
                                      {student.originalClass}ë°˜
                                    </span>
                                    
                                    {/* ì´ë¦„ */}
                                    <span style={{ fontWeight: '700' }}>{student.name}</span>
                                    
                                    {/* ì„±ë³„ */}
                                    <span style={{
                                      padding: '0.2rem 0.5rem',
                                      background: student.gender === 'ë‚¨ì„±' ? '#e3f2fd' : '#fce4ec',
                                      color: student.gender === 'ë‚¨ì„±' ? '#1976d2' : '#c2185b',
                                      borderRadius: '4px',
                                      fontSize: '0.75rem',
                                      fontWeight: '600'
                                    }}>
                                      {student.gender}
                                    </span>
                                    
                                    {/* íŠ¹ì´ì‚¬í•­ ë±ƒì§€ - ì£¼í™©ìƒ‰ í†µì¼ */}
                                    {specialNotes.map((note, noteIdx) => (
                                      <span
                                        key={noteIdx}
                                        style={{
                                          padding: '0.2rem 0.5rem',
                                          background: '#ff9800',
                                          color: 'white',
                                          borderRadius: '4px',
                                          fontSize: '0.7rem',
                                          fontWeight: '600'
                                        }}
                                      >
                                        {note}
                                      </span>
                                    ))}
                                    
                                    {/* ë™ëª…ì´ì¸/ì´ë¦„ì¤‘ë³µ ë±ƒì§€ */}
                                    {duplicateTypes.map((type, typeIdx) => (
                                      <span
                                        key={typeIdx}
                                        style={{
                                          padding: '0.2rem 0.5rem',
                                          background: '#e91e63',
                                          color: 'white',
                                          borderRadius: '4px',
                                          fontSize: '0.7rem',
                                          fontWeight: '600'
                                        }}
                                      >
                                        {type}
                                      </span>
                                    ))}
                                  </div>
                                </div>
                                
                                {/* ì´ë™ ë²„íŠ¼ë“¤ (1ëª…ë§Œ ì„ íƒë˜ì—ˆì„ ë•Œ) */}
                                {isSelected && selectedStudentsForSwap.length === 1 && (
                                  <div style={{
                                    display: 'flex',
                                    gap: '0.5rem',
                                    marginBottom: '0.5rem',
                                    flexWrap: 'wrap',
                                    padding: '0 0.5rem'
                                  }}>
                                    {Object.keys(results).sort().filter(cls => cls !== className).map(targetClass => (
                                      <button
                                        key={targetClass}
                                        onClick={(e) => {
                                          e.stopPropagation();
                                          moveStudent(className, student.id, targetClass);
                                          setSelectedStudentsForSwap([]);
                                        }}
                                        style={{
                                          padding: '0.4rem 0.8rem',
                                          background: 'white',
                                          border: '2px solid #667eea',
                                          borderRadius: '6px',
                                          fontSize: '0.8rem',
                                          fontWeight: '600',
                                          color: '#667eea',
                                          cursor: 'pointer',
                                          transition: 'all 0.2s'
                                        }}
                                        onMouseEnter={(e) => {
                                          e.target.style.background = '#667eea';
                                          e.target.style.color = 'white';
                                        }}
                                        onMouseLeave={(e) => {
                                          e.target.style.background = 'white';
                                          e.target.style.color = '#667eea';
                                        }}
                                      >
                                        {targetClass}ìœ¼ë¡œ ì´ë™
                                      </button>
                                    ))}
                                  </div>
                                )}
                              </div>
                            );
                          })}
                        </div>
                      </div>
                    );
                  })}
                </div>
              </div>
            )}

            {/* ê°™ì€ ë°˜ ê¸ˆì§€ í•™ìƒ ì„¤ì • */}
            {results && (
              <div style={{
                background: 'white',
                border: '2px solid #e0e0e0',
                borderRadius: '16px',
                padding: '2rem',
                marginBottom: '2rem',
                boxShadow: '0 4px 20px rgba(0, 0, 0, 0.08)'
              }}>
                <h3 style={{
                  fontSize: '1.3rem',
                  fontWeight: '700',
                  marginBottom: '1.5rem',
                  color: '#c2185b',
                  textAlign: 'center',
                  background: '#fce4ec',
                  padding: '1rem',
                  borderRadius: '12px'
                }}>
                  ê°™ì€ ë°˜ ê¸ˆì§€ í•™ìƒ ì„¤ì •
                </h3>

                {(() => {
                  const ProhibitContent = () => {
                    const [student1, setStudent1] = React.useState('');
                    const [student2, setStudent2] = React.useState('');

                    // ëª¨ë“  í•™ìƒ ëª©ë¡ (ì›ë˜ë°˜ ìˆœì„œëŒ€ë¡œ)
                    const allStudents = [];
                    Object.keys(results).sort().forEach(className => {
                      results[className].forEach(student => {
                        allStudents.push({
                          ...student,
                          currentClass: className
                        });
                      });
                    });

                    // ì›ë˜ë°˜ê³¼ ë²ˆí˜¸ë¡œ ì •ë ¬
                    allStudents.sort((a, b) => {
                      const classA = parseInt(a.originalClass) || 0;
                      const classB = parseInt(b.originalClass) || 0;
                      if (classA !== classB) return classA - classB;
                      return (parseInt(a.number) || 0) - (parseInt(b.number) || 0);
                    });

                    const addProhibitPair = () => {
                      if (!student1 || !student2) {
                        alert('ë‘ ëª…ì˜ í•™ìƒì„ ëª¨ë‘ ì„ íƒí•´ì£¼ì„¸ìš”.');
                        return;
                      }
                      if (student1 === student2) {
                        alert('ê°™ì€ í•™ìƒì„ ì„ íƒí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                        return;
                      }

                      const s1 = allStudents.find(s => s.id === student1);
                      const s2 = allStudents.find(s => s.id === student2);

                      if (prohibitPairs.some(pair => 
                        (pair.student1.id === student1 && pair.student2.id === student2) ||
                        (pair.student1.id === student2 && pair.student2.id === student1)
                      )) {
                        alert('ì´ë¯¸ ë“±ë¡ëœ ê¸ˆì§€ ì¡°í•©ì…ë‹ˆë‹¤.');
                        return;
                      }

                      setProhibitPairs([...prohibitPairs, {
                        student1: { 
                          id: s1.id, 
                          name: s1.name, 
                          originalClass: String(s1.originalClass || ''),
                          class: s1.currentClass 
                        },
                        student2: { 
                          id: s2.id, 
                          name: s2.name, 
                          originalClass: String(s2.originalClass || ''),
                          class: s2.currentClass 
                        },
                        active: false // ê¸°ë³¸ê°’ì€ ë¹„í™œì„±í™” (í‘œì‹œ ë²„íŠ¼ ìƒíƒœ)
                      }]);

                      setStudent1('');
                      setStudent2('');
                    };

                    const removeProhibitPair = (index) => {
                      setProhibitPairs(prohibitPairs.filter((_, i) => i !== index));
                    };

                    return (
                      <div>
                        <div style={{
                          display: 'flex',
                          gap: '1rem',
                          marginBottom: '1.5rem',
                          flexWrap: 'wrap',
                          alignItems: 'center'
                        }}>
                          <select
                            value={student1}
                            onChange={(e) => setStudent1(e.target.value)}
                            style={{
                              flex: 1,
                              minWidth: '250px',
                              padding: '0.75rem',
                              fontSize: '1rem',
                              borderRadius: '8px',
                              border: '2px solid #e0e0e0',
                              background: 'white'
                            }}
                          >
                            <option value="">í•™ìƒ ì„ íƒ</option>
                            {allStudents.map(student => (
                              <option key={student.id} value={student.id}>
                                {student.originalClass}ë°˜ {student.number}ë²ˆ {student.name} (í˜„ì¬: {student.currentClass})
                              </option>
                            ))}
                          </select>

                          <select
                            value={student2}
                            onChange={(e) => setStudent2(e.target.value)}
                            style={{
                              flex: 1,
                              minWidth: '250px',
                              padding: '0.75rem',
                              fontSize: '1rem',
                              borderRadius: '8px',
                              border: '2px solid #e0e0e0',
                              background: 'white'
                            }}
                          >
                            <option value="">í•™ìƒ ì„ íƒ</option>
                            {allStudents.map(student => (
                              <option key={student.id} value={student.id}>
                                {student.originalClass}ë°˜ {student.number}ë²ˆ {student.name} (í˜„ì¬: {student.currentClass})
                              </option>
                            ))}
                          </select>

                          <button
                            onClick={addProhibitPair}
                            style={{
                              padding: '0.75rem 2rem',
                              background: '#c2185b',
                              color: 'white',
                              border: 'none',
                              borderRadius: '8px',
                              fontWeight: '700',
                              cursor: 'pointer',
                              fontSize: '1rem',
                              minWidth: '100px'
                            }}
                          >
                            ì¶”ê°€
                          </button>
                        </div>

                        {/* ë“±ë¡ëœ ê¸ˆì§€ ì¡°í•© ëª©ë¡ */}
                        {prohibitPairs.length > 0 && (
                          <div style={{
                            background: '#f8f9fa',
                            borderRadius: '8px',
                            padding: '1.5rem',
                            border: '1px solid #e0e0e0'
                          }}>
                            <h4 style={{
                              margin: '0 0 1rem 0',
                              fontSize: '1.1rem',
                              fontWeight: '600',
                              color: '#333'
                            }}>
                              ë“±ë¡ëœ ê¸ˆì§€ ì¡°í•© ({prohibitPairs.length}ê°œ)
                            </h4>
                            <div style={{
                              display: 'grid',
                              gap: '0.75rem'
                            }}>
                              {prohibitPairs.map((pair, index) => (
                                <div
                                  key={index}
                                  style={{
                                    display: 'flex',
                                    justifyContent: 'space-between',
                                    alignItems: 'center',
                                    padding: '1rem',
                                    background: 'white',
                                    borderRadius: '8px',
                                    border: '1px solid #e0e0e0'
                                  }}
                                >
                                  <span style={{ fontSize: '1rem', color: '#333', fontWeight: '500' }}>
                                    {pair.student1.name} ({pair.student1.class}) â†” {pair.student2.name} ({pair.student2.class})
                                  </span>
                                  <div style={{ display: 'flex', gap: '0.5rem' }}>
                                    <button
                                      onClick={() => {
                                        if (pair.active) {
                                          // ì‚­ì œ â†’ ë¹„í™œì„±í™” (í‘œì‹œ ë²„íŠ¼ìœ¼ë¡œ ë˜ëŒë¦¼)
                                          const newPairs = prohibitPairs.map((p, i) => 
                                            i === index ? { ...p, active: false } : p
                                          );
                                          setProhibitPairs(newPairs);
                                          setForceUpdateKey(prev => prev + 1);
                                        } else {
                                          // í‘œì‹œ (í™œì„±í™”)
                                          const newPairs = prohibitPairs.map((p, i) => 
                                            i === index ? { ...p, active: true } : p
                                          );
                                          setProhibitPairs(newPairs);
                                          setForceUpdateKey(prev => prev + 1);
                                        }
                                      }}
                                      style={{
                                        padding: '0.5rem 1rem',
                                        background: pair.active ? '#ff6b6b' : '#4caf50',
                                        color: 'white',
                                        border: 'none',
                                        borderRadius: '6px',
                                        cursor: 'pointer',
                                        fontSize: '0.9rem',
                                        fontWeight: '600',
                                        minWidth: '70px'
                                      }}
                                    >
                                      {pair.active ? 'ìˆ¨ê¹€' : 'í‘œì‹œ'}
                                    </button>
                                    <button
                                      onClick={() => {
                                        removeProhibitPair(index);
                                        setForceUpdateKey(prev => prev + 1);
                                      }}
                                      style={{
                                        padding: '0.5rem 1rem',
                                        background: '#666',
                                        color: 'white',
                                        border: 'none',
                                        borderRadius: '6px',
                                        cursor: 'pointer',
                                        fontSize: '0.9rem',
                                        fontWeight: '600'
                                      }}
                                    >
                                      ì œê±°
                                    </button>
                                  </div>
                                </div>
                              ))}
                            </div>
                          </div>
                        )}
                      </div>
                    );
                  };

                  return <ProhibitContent />;
                })()}
              </div>
            )}

            {/* ë°˜í¸ì„± ì™„ë£Œ/ìˆ˜ì • ë²„íŠ¼ */}
            {results && (
              <div style={{
                display: 'flex',
                justifyContent: 'center',
                gap: '1rem',
                marginBottom: '2rem'
              }}>
                <button
                  onClick={() => setIsCompleted(!isCompleted)}
                  style={{
                    padding: '1rem 3rem',
                    background: isCompleted ? 'linear-gradient(135deg, #f093fb 0%, #f5576c 100%)' : 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
                    color: 'white',
                    border: 'none',
                    borderRadius: '12px',
                    fontSize: '1.2rem',
                    fontWeight: '700',
                    cursor: 'pointer',
                    boxShadow: '0 8px 20px rgba(0, 0, 0, 0.2)',
                    transition: 'all 0.3s'
                  }}
                  onMouseEnter={(e) => {
                    e.target.style.transform = 'translateY(-2px)';
                    e.target.style.boxShadow = '0 12px 28px rgba(0, 0, 0, 0.3)';
                  }}
                  onMouseLeave={(e) => {
                    e.target.style.transform = 'translateY(0)';
                    e.target.style.boxShadow = '0 8px 20px rgba(0, 0, 0, 0.2)';
                  }}
                >
                  {isCompleted ? 'âœï¸ ë°˜í¸ì„± ìˆ˜ì •í•˜ê¸°' : 'âœ… ë°˜í¸ì„± ì™„ë£Œí•˜ê¸°'}
                </button>

                <button
                  onClick={downloadExcel}
                  style={{
                    padding: '1rem 3rem',
                    background: '#4caf50',
                    color: 'white',
                    border: 'none',
                    borderRadius: '12px',
                    fontSize: '1.2rem',
                    fontWeight: '700',
                    cursor: 'pointer',
                    boxShadow: '0 4px 12px rgba(76, 175, 80, 0.3)',
                    transition: 'all 0.3s'
                  }}
                  onMouseEnter={(e) => {
                    e.target.style.background = '#45a049';
                    e.target.style.transform = 'translateY(-2px)';
                    e.target.style.boxShadow = '0 6px 16px rgba(76, 175, 80, 0.4)';
                  }}
                  onMouseLeave={(e) => {
                    e.target.style.background = '#4caf50';
                    e.target.style.transform = 'translateY(0)';
                    e.target.style.boxShadow = '0 4px 12px rgba(76, 175, 80, 0.3)';
                  }}
                >
                  â¬‡ï¸ ì—‘ì…€ ë‹¤ìš´ë¡œë“œ
                </button>
              </div>
            )}

            {/* ê°™ì€ ë°˜ ê¸ˆì§€ í•™ìƒ ì„¤ì • ëª¨ë‹¬ (ì œê±° ì˜ˆì • - ì‚¬ìš© ì•ˆ í•¨) */}
            {showProhibitModal && results && (
              <div
                style={{
                  position: 'fixed',
                  top: 0,
                  left: 0,
                  right: 0,
                  bottom: 0,
                  background: 'rgba(0, 0, 0, 0.5)',
                  display: 'flex',
                  alignItems: 'center',
                  justifyContent: 'center',
                  zIndex: 1000,
                  padding: '1rem'
                }}
                onClick={() => setShowProhibitModal(false)}
              >
                <div
                  style={{
                    background: '#fce4ec',
                    borderRadius: '16px',
                    padding: '2rem',
                    maxWidth: '900px',
                    width: '100%',
                    maxHeight: '90vh',
                    overflowY: 'auto',
                    boxShadow: '0 20px 60px rgba(0, 0, 0, 0.3)'
                  }}
                  onClick={(e) => e.stopPropagation()}
                >
                  <h3 style={{
                    margin: '0 0 1.5rem 0',
                    fontSize: '1.5rem',
                    fontWeight: '700',
                    color: '#c2185b',
                    textAlign: 'center'
                  }}>
                    ê°™ì€ ë°˜ ê¸ˆì§€ í•™ìƒ í‘œì‹œ
                  </h3>

                  {(() => {
                    const ProhibitModalContent = () => {
                      const [student1, setStudent1] = React.useState('');
                      const [student2, setStudent2] = React.useState('');

                      // ëª¨ë“  í•™ìƒ ëª©ë¡ (ì›ë˜ë°˜ ìˆœì„œëŒ€ë¡œ)
                      const allStudents = [];
                      Object.keys(results).sort().forEach(className => {
                        results[className].forEach(student => {
                          allStudents.push({
                            ...student,
                            currentClass: className
                          });
                        });
                      });

                      // ì›ë˜ë°˜ê³¼ ë²ˆí˜¸ë¡œ ì •ë ¬
                      allStudents.sort((a, b) => {
                        const classA = parseInt(a.originalClass) || 0;
                        const classB = parseInt(b.originalClass) || 0;
                        if (classA !== classB) return classA - classB;
                        return (parseInt(a.number) || 0) - (parseInt(b.number) || 0);
                      });

                      const addProhibitPair = () => {
                        if (!student1 || !student2) {
                          alert('ë‘ ëª…ì˜ í•™ìƒì„ ëª¨ë‘ ì„ íƒí•´ì£¼ì„¸ìš”.');
                          return;
                        }
                        if (student1 === student2) {
                          alert('ê°™ì€ í•™ìƒì„ ì„ íƒí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                          return;
                        }

                        const s1 = allStudents.find(s => s.id === student1);
                        const s2 = allStudents.find(s => s.id === student2);

                        if (prohibitPairs.some(pair => 
                          (pair.student1.id === student1 && pair.student2.id === student2) ||
                          (pair.student1.id === student2 && pair.student2.id === student1)
                        )) {
                          alert('ì´ë¯¸ ë“±ë¡ëœ ê¸ˆì§€ ì¡°í•©ì…ë‹ˆë‹¤.');
                          return;
                        }

                        setProhibitPairs([...prohibitPairs, {
                          student1: { id: s1.id, name: s1.name, class: s1.currentClass },
                          student2: { id: s2.id, name: s2.name, class: s2.currentClass }
                        }]);

                        setStudent1('');
                        setStudent2('');
                      };

                      const removeProhibitPair = (index) => {
                        setProhibitPairs(prohibitPairs.filter((_, i) => i !== index));
                      };

                      return (
                        <div>
                          <div style={{
                            display: 'flex',
                            gap: '1rem',
                            marginBottom: '1.5rem',
                            flexWrap: 'wrap'
                          }}>
                            <select
                              value={student1}
                              onChange={(e) => setStudent1(e.target.value)}
                              style={{
                                flex: 1,
                                minWidth: '200px',
                                padding: '0.75rem',
                                fontSize: '1rem',
                                borderRadius: '8px',
                                border: '2px solid #e0e0e0',
                                background: 'white'
                              }}
                            >
                              <option value="">í•™ìƒ ì„ íƒ</option>
                              {allStudents.map(student => (
                                <option key={student.id} value={student.id}>
                                  {student.originalClass}ë°˜ {student.number}ë²ˆ {student.name} (í˜„ì¬: {student.currentClass})
                                </option>
                              ))}
                            </select>

                            <select
                              value={student2}
                              onChange={(e) => setStudent2(e.target.value)}
                              style={{
                                flex: 1,
                                minWidth: '200px',
                                padding: '0.75rem',
                                fontSize: '1rem',
                                borderRadius: '8px',
                                border: '2px solid #e0e0e0',
                                background: 'white'
                              }}
                            >
                              <option value="">í•™ìƒ ì„ íƒ</option>
                              {allStudents.map(student => (
                                <option key={student.id} value={student.id}>
                                  {student.originalClass}ë°˜ {student.number}ë²ˆ {student.name} (í˜„ì¬: {student.currentClass})
                                </option>
                              ))}
                            </select>

                            <button
                              onClick={addProhibitPair}
                              style={{
                                padding: '0.75rem 1.5rem',
                                background: '#c2185b',
                                color: 'white',
                                border: 'none',
                                borderRadius: '8px',
                                fontWeight: '600',
                                cursor: 'pointer',
                                fontSize: '1rem'
                              }}
                            >
                              ì¶”ê°€
                            </button>
                          </div>

                          {/* ë“±ë¡ëœ ê¸ˆì§€ ì¡°í•© ëª©ë¡ */}
                          {prohibitPairs.length > 0 && (
                            <div style={{
                              background: 'white',
                              borderRadius: '8px',
                              padding: '1rem',
                              marginBottom: '1rem'
                            }}>
                              <h4 style={{
                                margin: '0 0 1rem 0',
                                fontSize: '1.1rem',
                                fontWeight: '600',
                                color: '#333'
                              }}>
                                ë“±ë¡ëœ ê¸ˆì§€ ì¡°í•© ({prohibitPairs.length}ê°œ)
                              </h4>
                              {prohibitPairs.map((pair, index) => (
                                <div
                                  key={index}
                                  style={{
                                    display: 'flex',
                                    justifyContent: 'space-between',
                                    alignItems: 'center',
                                    padding: '0.75rem',
                                    marginBottom: '0.5rem',
                                    background: '#f8f9fa',
                                    borderRadius: '8px',
                                    border: '1px solid #e0e0e0'
                                  }}
                                >
                                  <span style={{ fontSize: '0.95rem', color: '#333' }}>
                                    {pair.student1.name} ({pair.student1.class}) â†” {pair.student2.name} ({pair.student2.class})
                                  </span>
                                  <button
                                    onClick={() => removeProhibitPair(index)}
                                    style={{
                                      padding: '0.4rem 0.8rem',
                                      background: '#ff6b6b',
                                      color: 'white',
                                      border: 'none',
                                      borderRadius: '6px',
                                      cursor: 'pointer',
                                      fontSize: '0.85rem',
                                      fontWeight: '600'
                                    }}
                                  >
                                    ì‚­ì œ
                                  </button>
                                </div>
                              ))}
                            </div>
                          )}

                          <button
                            onClick={() => setShowProhibitModal(false)}
                            style={{
                              width: '100%',
                              padding: '1rem',
                              background: '#c2185b',
                              color: 'white',
                              border: 'none',
                              borderRadius: '8px',
                              fontSize: '1.1rem',
                              fontWeight: '700',
                              cursor: 'pointer'
                            }}
                          >
                            í™•ì¸
                          </button>
                        </div>
                      );
                    };

                    return <ProhibitModalContent />;
                  })()}
                </div>
              </div>
            )}
          </div>
        </div>
      );
    }

    ReactDOM.render(<App />, document.getElementById('root'));
  </script>
</body>
</html>
